---
import Sun from "./icons/sun.astro";
import Moon from "./icons/moon.astro";
---

<script>
  let last;

  fetch("/api/last-visitor")
    .then((res) => res.json())
    .then((data) => {
      last = data.result;

      const lastVisitElement = document.querySelector(".last-visit");
      if (lastVisitElement) {
        lastVisitElement.textContent = last;
        lastVisitElement.classList.remove(
          "animate-pulse",
          "bg-neutral-200",
          "dark:bg-neutral-700",
          "h-4",
          "w-28",
          "mt-0.5",
          "rounded"
        );
      }
    });
</script>

<script>
  const handleToggleClick = () => {
    const element = document.documentElement;
    element.classList.toggle("dark");

    const isDark = element.classList.contains("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");
  };

  document
    .getElementById("themeToggle")
    ?.addEventListener("click", handleToggleClick);
</script>

<footer
  class="animate-intro mt-12 mb-16 flex items-center justify-between opacity-0 [animation-delay:0.55s]"
>
  <div>
    <p class="text-sm font-light text-neutral-500 dark:text-neutral-400">
      Made with <a
        href="https://astro.build/"
        target="_blank"
        rel="noreferrer"
        class="font-normal">Astro</a
      >
    </p>
    <p
      class="flex items-center text-sm font-light text-neutral-500 dark:text-neutral-400"
    >
      Last visit from <span
        class="last-visit mt-0.5 ml-1 inline-block h-4 w-28 animate-pulse rounded bg-neutral-200 dark:bg-neutral-700"
      ></span>
    </p>
  </div>
  <button
    id="themeToggle"
    aria-label="Toggle theme"
    class="flex size-6 items-center justify-center"
  >
    <span class="sun block text-neutral-900 dark:hidden">
      <Sun />
    </span>
    <span class="moon hidden text-neutral-100 dark:block">
      <Moon />
    </span>
  </button>
</footer>
<style>
  .sun svg,
  .moon svg {
    width: 20px;
    height: 20px;
  }
</style>
