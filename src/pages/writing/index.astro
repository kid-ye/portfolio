---
import Layout from "../../components/layout.astro";
import IndexIcon from "../../components/icons/index.astro";

const posts = await Astro.glob("./*.mdx");
posts.sort(
  (a, b) =>
    new Date(b.frontmatter.pubDate).valueOf() -
    new Date(a.frontmatter.pubDate).valueOf()
);
---

<Layout title="Writing">
  <main class="relative">
    <div class="mb-4 md:absolute md:-ml-36 md:mb-0 md:h-full">
      <a class="exclude flex items-center gap-x-1 md:sticky md:top-8" href="/"
        ><IndexIcon /> Index
      </a>
    </div>
    <header>
      <h2 class="mb-6 font-semibold">Writing</h2>
    </header>
    <ul>
      {
        posts.map((post, index) => {
          const date = new Date(post.frontmatter.pubDate);
          const year = date.getFullYear();
          const prevPost = posts[index - 1];
          const prevYear = prevPost
            ? new Date(prevPost.frontmatter.pubDate).getFullYear()
            : null;
          const showYear = year !== prevYear;
          const nextPost = posts[index + 1];
          const nextYear = nextPost
            ? new Date(nextPost.frontmatter.pubDate).getFullYear()
            : null;
          const isLastInYear = year !== nextYear && nextPost;

          return (
            <li
              class={`flex items-baseline ${
                isLastInYear
                  ? "border-b border-neutral-200 dark:border-neutral-800"
                  : ""
              }`}
            >
              <div class="w-12 shrink-0 font-normal text-neutral-500 dark:text-neutral-400">
                {showYear ? year : ""}
              </div>
              <a
                href={post.url}
                class="exclude group flex flex-1 items-center justify-between gap-4 rounded-md px-3 py-2 hover:bg-neutral-200 dark:hover:bg-neutral-800"
              >
                <span class="font-normal text-neutral-900 dark:text-neutral-100">
                  {post.frontmatter.title}
                </span>
                <span class="shrink-0 text-sm tabular-nums text-neutral-500 dark:text-neutral-400">
                  {date.toLocaleDateString("en-US", {
                    month: "2-digit",
                    day: "2-digit",
                  })}
                </span>
              </a>
            </li>
          );
        })
      }
    </ul>
  </main>
</Layout>
